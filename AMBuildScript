# AMBuildScript
import os

cxx = builder.DetectCxx(target_arch=builder.options.targets)
library = cxx.Library('momsurffix_ext.ext')

library.sources += [ 'momsurffix_ext.cpp' ]

library.compiler.includes += [
    builder.sourcePath,
    os.path.join(builder.options.sm_path, 'public'),
    os.path.join(builder.options.sm_path, 'public/extensions'),
    os.path.join(builder.options.sm_path, 'public/sourcepawn'),
    os.path.join(builder.options.sm_path, 'sourcepawn/include'),
    os.path.join(builder.options.sm_path, 'public/amtl'),
    os.path.join(builder.options.mms_path, 'core'),
    os.path.join(builder.options.mms_path, 'core/sourcehook'), # 确保包含 SourceHook
    os.path.join(builder.options.hl2sdk_path, 'public'),
    os.path.join(builder.options.hl2sdk_path, 'public/engine'),
    os.path.join(builder.options.hl2sdk_path, 'public/mathlib'),
    os.path.join(builder.options.hl2sdk_path, 'public/vstdlib'),
    os.path.join(builder.options.hl2sdk_path, 'public/tier0'),
    os.path.join(builder.options.hl2sdk_path, 'public/tier1'),
]

library.compiler.linkflags += ['-m32']
# 链接必要的静态库
library.compiler.postlink += [
    os.path.join(builder.options.hl2sdk_path, 'lib/linux/tier1_i486.a'),
    os.path.join(builder.options.hl2sdk_path, 'lib/linux/mathlib_i486.a'),
    os.path.join(builder.options.hl2sdk_path, 'lib/linux/interfaces_i486.a'), # 可能需要 interfaces
]

library.compiler.defines += ['SOURCEMOD_BUILD', 'HAVE_STRING_H', 'SE_EPISODEONE', 'COMPILER_GCC'] # 根据 SDK 版本可能需要 SE_ 定义

builder.Add(library)
